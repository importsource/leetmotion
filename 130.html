<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode 130 Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        code, pre { font-family: 'Fira Code', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        .cell-content { transition: all 0.3s ease; }
        .highlight-line { background-color: rgba(234, 179, 8, 0.15); border-left: 3px solid #eab308; }
        .code-line { transition: background-color 0.2s; }
        
        /* Grid dynamic columns */
        #board-grid {
            display: grid;
            grid-template-columns: repeat(10, minmax(0, 1fr));
            gap: 0.25rem; /* gap-1 */
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 h-screen w-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="flex-none p-4 border-b border-slate-700 bg-slate-900/50 backdrop-blur-sm z-50 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl md:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                LeetCode 130: Surrounded Regions
            </h1>
            <div class="hidden md:flex space-x-4 text-sm font-medium">
                <div class="flex items-center space-x-1">
                    <div class="w-3 h-3 bg-blue-900/40 border border-blue-700 rounded"></div>
                    <span>O (Open)</span>
                </div>
                <div class="flex items-center space-x-1">
                    <div class="w-3 h-3 bg-slate-800 border border-slate-600 rounded"></div>
                    <span>X (Captured)</span>
                </div>
                <div class="flex items-center space-x-1">
                    <div class="w-3 h-3 bg-emerald-900/40 border border-emerald-700 rounded"></div>
                    <span># (Safe)</span>
                </div>
            </div>
        </div>
        <a href="https://importsource.github.io/leetmotion/" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-2 text-slate-400 hover:text-white transition-colors text-sm font-semibold">
            <span>LeetMotion Home</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        </a>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        
        <!-- Left Panel: Controls, Board, Logs -->
        <div class="flex-1 flex flex-col p-4 space-y-4 overflow-y-auto relative">
            
            <!-- Controls -->
            <div class="flex flex-wrap items-center gap-4 bg-slate-800/50 p-4 rounded-xl border border-slate-700 sticky top-0 z-20 backdrop-blur-md">
                 <button id="runBtn" class="flex items-center space-x-2 px-6 py-2 rounded-lg font-semibold transition-all bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50 disabled:opacity-50 disabled:cursor-not-allowed">
                   <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                   <span id="runBtnText">Run DFS</span>
                 </button>

                 <button id="resetBtn" class="flex items-center space-x-2 px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-200 transition-colors">
                   <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>
                   <span>Reset Board</span>
                 </button>

                 <div class="flex items-center space-x-2 ml-auto">
                    <span class="text-slate-400 text-sm">Speed:</span>
                    <input type="range" id="speedInput" min="10" max="500" step="10" value="400" class="w-24 md:w-32 accent-blue-500 cursor-pointer">
                 </div>
            </div>

            <!-- Board Container -->
            <div class="flex-1 flex items-center justify-center min-h-[400px] bg-[#0f172a] rounded-xl border border-slate-800 relative overflow-hidden group">
                <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
                <!-- The Grid -->
                <div id="board-grid" class="bg-slate-800 p-2 rounded-lg shadow-xl select-none z-10 transition-all duration-300">
                    <!-- Cells injected by JS -->
                </div>
            </div>

            <!-- Logs -->
            <div class="h-40 bg-slate-900 rounded-lg border border-slate-800 p-3 overflow-y-auto font-mono text-sm space-y-1 relative" id="logsPanel">
                <div id="logsContent">
                    <span class="text-slate-600 italic">Logs will appear here...</span>
                </div>
            </div>

        </div>

        <!-- Right Panel: Code -->
        <div class="h-1/3 lg:h-auto lg:w-1/3 p-4 border-t lg:border-t-0 lg:border-l border-slate-700 bg-slate-900 flex flex-col">
           <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400 border border-slate-700 rounded-t-lg flex justify-between items-center flex-none">
             <span>Solution.java</span>
             <span class="text-[10px] text-slate-500">Read-only</span>
           </div>
           <div class="flex-1 overflow-auto bg-[#1e1e1e] border-x border-b border-slate-700 rounded-b-lg relative custom-scrollbar" id="codeScroller">
             <div id="codeContainer" class="py-4">
                <!-- Code injected by JS -->
             </div>
           </div>
        </div>

    </main>

    <script>
        // --- Configuration & State ---
        const ROWS = 10;
        const COLS = 10;
        let grid = [];
        let isRunning = false;
        let shouldAbort = false;
        let speed = 100; // ms delay

        const JAVA_CODE = `class Solution {
    public void solve(char[][] board) {
        // First check board validity.
        // If board is empty or null, there is nothing to process.
        if (board == null || board.length == 0) {
            return;
        }

        // We store number of rows and columns for easier access,
        // since we will use them often in loops and DFS boundary checking.
        int rows = board.length;
        int cols = board[0].length;

        // Step 1: Run DFS from all border cells.
        // Why? Because any 'O' touching the border cannot be flipped.
        // We mark these safe 'O' as '#'.
        
        // Traverse first and last row
        for (int j = 0; j < cols; j++) {
            // Top row
            if (board[0][j] == 'O') {
                dfs(board, 0, j);
            }
            // Bottom row
            if (board[rows - 1][j] == 'O') {
                dfs(board, rows - 1, j);
            }
        }

        // Traverse first and last column
        for (int i = 0; i < rows; i++) {
            // Left column
            if (board[i][0] == 'O') {
                dfs(board, i, 0);
            }
            // Right column
            if (board[i][cols - 1] == 'O') {
                dfs(board, i, cols - 1);
            }
        }

        // Step 2: Scan the board.
        // All remaining 'O' are surrounded and should become 'X'.
        // All '#' are safe and should turn back to 'O'.
        for (int i = 0; i < rows; i++) {
            for (int j = 0; j < cols; j++) {

                // If it's an 'O', it means it was never touched by DFS,
                // therefore it must be a surrounded region â†’ flip to 'X'.
                if (board[i][j] == 'O') {
                    board[i][j] = 'X';
                }

                // If it's '#', it means it was connected to the border,
                // so restore it as 'O'.
                if (board[i][j] == '#') {
                    board[i][j] = 'O';
                }
            }
        }
    }

    private void dfs(char[][] board, int i, int j) {
        int rows = board.length;
        int cols = board[0].length;

        // Boundary check: stop if out of range
        if (i < 0 || i >= rows || j < 0 || j >= cols) {
            return;
        }

        // If current cell is not 'O', stop.
        // We only expand from 'O' cells.
        if (board[i][j] != 'O') {
            return;
        }

        // Mark current cell as '#'
        // This means it is safe and connected to border.
        board[i][j] = '#';

        // Continue DFS in four directions.
        dfs(board, i + 1, j); // down
        dfs(board, i - 1, j); // up
        dfs(board, i, j + 1); // right
        dfs(board, i, j - 1); // left
    }
}`;

        // --- DOM Elements ---
        const boardGrid = document.getElementById('board-grid');
        const runBtn = document.getElementById('runBtn');
        const resetBtn = document.getElementById('resetBtn');
        const speedInput = document.getElementById('speedInput');
        const codeContainer = document.getElementById('codeContainer');
        const logsContent = document.getElementById('logsContent');
        const logsPanel = document.getElementById('logsPanel');
        const codeScroller = document.getElementById('codeScroller');

        // --- Initialization ---
        function init() {
            renderCode();
            resetBoard();
            
            runBtn.addEventListener('click', runAlgorithm);
            resetBtn.addEventListener('click', () => {
                shouldAbort = true;
                resetBoard();
            });
            speedInput.addEventListener('input', (e) => {
                speed = 510 - parseInt(e.target.value);
            });
            // Init speed
            speed = 510 - parseInt(speedInput.value);
        }

        function resetBoard() {
            grid = [];
            boardGrid.innerHTML = '';
            logsContent.innerHTML = '';
            shouldAbort = false;
            isRunning = false;
            updateControls();
            unhighlightAllLines();

            for(let r=0; r<ROWS; r++) {
                let row = [];
                for(let c=0; c<COLS; c++) {
                    const isO = Math.random() > 0.45;
                    row.push({
                        r, c,
                        value: isO ? 'O' : 'X',
                        element: createCellElement(r, c, isO ? 'O' : 'X')
                    });
                }
                grid.push(row);
            }
            addLog('Board initialized.', 'info');
        }

        function createCellElement(r, c, val) {
            const el = document.createElement('div');
            el.className = 'w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 flex items-center justify-center font-mono font-bold text-lg rounded border-2 cell-content';
            el.id = `cell-${r}-${c}`;
            updateCellStyle(el, val);
            boardGrid.appendChild(el);
            return el;
        }

        function updateCellStyle(el, val, isCurrent = false, isVisiting = false) {
            el.textContent = val;
            
            // Base Colors
            let bgColor = 'bg-slate-700';
            let textColor = 'text-slate-400';
            let borderColor = 'border-slate-600';

            if (val === 'O') {
                bgColor = 'bg-blue-900/40';
                textColor = 'text-blue-400';
                borderColor = 'border-blue-700';
            } else if (val === 'X') {
                bgColor = 'bg-slate-800';
                textColor = 'text-slate-600';
                borderColor = 'border-slate-800';
            } else if (val === '#') {
                bgColor = 'bg-emerald-900/40';
                textColor = 'text-emerald-400';
                borderColor = 'border-emerald-700';
            }

            // Status Overrides
            if (isCurrent) {
                borderColor = 'border-yellow-400 ring-2 ring-yellow-400/50 z-10 scale-110 shadow-lg';
            } else if (isVisiting) {
                borderColor = 'border-purple-500 shadow-purple-500/20 shadow-md';
            }

            el.className = `w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 flex items-center justify-center font-mono font-bold text-lg rounded border-2 cell-content transition-all duration-300 ${bgColor} ${textColor} ${borderColor}`;
        }

        function renderCode() {
            const lines = JAVA_CODE.split('\n');
            codeContainer.innerHTML = '';
            lines.forEach((line, idx) => {
                const lineNum = idx + 1;
                const div = document.createElement('div');
                div.id = `line-${lineNum}`;
                div.className = 'code-line relative pl-10 pr-2';
                
                const numSpan = document.createElement('span');
                numSpan.className = 'absolute left-0 top-0 w-8 text-right text-slate-600 select-none text-xs leading-6 pr-1';
                numSpan.textContent = lineNum;

                const codePre = document.createElement('pre');
                codePre.className = 'text-slate-300 font-mono text-sm leading-6 whitespace-pre';
                codePre.textContent = line;

                div.appendChild(numSpan);
                div.appendChild(codePre);
                codeContainer.appendChild(div);
            });
        }

        // --- Helpers ---
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function wait() {
            if (shouldAbort) throw new Error("Aborted");
            await sleep(speed);
        }

        function addLog(msg, type='info') {
            const div = document.createElement('div');
            let color = 'text-slate-400';
            if(type==='action') color='text-blue-400';
            if(type==='success') color='text-emerald-400';
            
            div.className = `${color} text-xs md:text-sm font-mono`;
            div.innerHTML = `<span class="opacity-50 mr-2">[${new Date().toLocaleTimeString().split(' ')[0]}]</span>${msg}`;
            
            logsContent.appendChild(div);
            logsPanel.scrollTop = logsPanel.scrollHeight;
        }

        async function highlightLine(lineNum) {
            unhighlightAllLines();
            const el = document.getElementById(`line-${lineNum}`);
            if (el) {
                el.classList.add('highlight-line');
                // Scroll into view if needed
                const containerRect = codeScroller.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                if (elRect.top < containerRect.top || elRect.bottom > containerRect.bottom) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            await wait();
        }

        function unhighlightAllLines() {
            const active = document.querySelectorAll('.highlight-line');
            active.forEach(el => el.classList.remove('highlight-line'));
        }

        function setCell(r, c, val, isCurrent=false, isVisiting=false) {
            grid[r][c].value = val;
            updateCellStyle(grid[r][c].element, val, isCurrent, isVisiting);
        }

        function updateControls() {
            runBtn.disabled = isRunning;
            document.getElementById('runBtnText').textContent = isRunning ? 'Running...' : 'Run DFS';
            runBtn.className = isRunning 
                ? 'flex items-center space-x-2 px-6 py-2 rounded-lg font-semibold transition-all bg-slate-700 text-slate-500 cursor-not-allowed'
                : 'flex items-center space-x-2 px-6 py-2 rounded-lg font-semibold transition-all bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50';
        }

        // --- Algorithm Implementation ---
        async function runAlgorithm() {
            if(isRunning) return;
            isRunning = true;
            shouldAbort = false;
            updateControls();
            
            try {
                // Line 5: Check null
                await highlightLine(5);
                
                // Line 10-11: Dimensions
                await highlightLine(10);

                // Step 1: Check Borders
                addLog('Step 1: Checking borders for "O"', 'info');
                await highlightLine(18); // Loop top/bottom

                // Top & Bottom Rows
                for(let j=0; j<COLS; j++) {
                    // Top Row
                    await highlightLine(20);
                    setCell(0, j, grid[0][j].value, true); // Highlight check
                    await wait();
                    
                    if(grid[0][j].value === 'O') {
                        addLog(`Found 'O' at (0, ${j}). Starting DFS.`, 'action');
                        await highlightLine(21);
                        await dfs(0, j);
                    }
                    setCell(0, j, grid[0][j].value, false); // Remove highlight

                    // Bottom Row
                    await highlightLine(24);
                    setCell(ROWS-1, j, grid[ROWS-1][j].value, true);
                    await wait();

                    if(grid[ROWS-1][j].value === 'O') {
                        addLog(`Found 'O' at (${ROWS-1}, ${j}). Starting DFS.`, 'action');
                        await highlightLine(25);
                        await dfs(ROWS-1, j);
                    }
                    setCell(ROWS-1, j, grid[ROWS-1][j].value, false);
                }

                // Left & Right Cols
                await highlightLine(29);
                for(let i=0; i<ROWS; i++) {
                    // Left Col
                    await highlightLine(31);
                    setCell(i, 0, grid[i][0].value, true);
                    await wait();

                    if(grid[i][0].value === 'O') {
                         addLog(`Found 'O' at (${i}, 0). Starting DFS.`, 'action');
                         await highlightLine(32);
                         await dfs(i, 0);
                    }
                    setCell(i, 0, grid[i][0].value, false);

                    // Right Col
                    await highlightLine(35);
                    setCell(i, COLS-1, grid[i][COLS-1].value, true);
                    await wait();
                    
                    if(grid[i][COLS-1].value === 'O') {
                        addLog(`Found 'O' at (${i}, ${COLS-1}). Starting DFS.`, 'action');
                        await highlightLine(36);
                        await dfs(i, COLS-1);
                    }
                    setCell(i, COLS-1, grid[i][COLS-1].value, false);
                }

                addLog('Border check complete. Safe regions marked #.', 'success');

                // Step 2: Scan Board
                addLog('Step 2: Flipping captured regions.', 'info');
                await highlightLine(43);

                for(let i=0; i<ROWS; i++) {
                    for(let j=0; j<COLS; j++) {
                        setCell(i, j, grid[i][j].value, true); // Current
                        
                        await highlightLine(49); // Check O
                        if(grid[i][j].value === 'O') {
                            await wait();
                            setCell(i, j, 'X', true);
                            addLog(`Captured 'O' at (${i}, ${j}) -> X`, 'action');
                            await highlightLine(50);
                            await wait();
                        }

                        await highlightLine(55); // Check #
                        if(grid[i][j].value === '#') {
                            await wait();
                            setCell(i, j, 'O', true);
                            addLog(`Restoring Safe '#' at (${i}, ${j}) -> O`, 'success');
                            await highlightLine(56);
                            await wait();
                        }
                        
                        setCell(i, j, grid[i][j].value, false); // Unhighlight
                    }
                }

                addLog('Algorithm Finished!', 'success');
                unhighlightAllLines();

            } catch(e) {
                if(e.message === 'Aborted') {
                    addLog('Execution Reset', 'info');
                } else {
                    console.error(e);
                }
            } finally {
                isRunning = false;
                updateControls();
            }
        }

        async function dfs(r, c) {
            if(shouldAbort) throw new Error('Aborted');

            await highlightLine(61);
            
            // Bounds check
            await highlightLine(66);
            if(r < 0 || r >= ROWS || c < 0 || c >= COLS) return;

            // 'O' check
            await highlightLine(72);
            setCell(r, c, grid[r][c].value, true);
            await wait();
            
            if(grid[r][c].value !== 'O') {
                setCell(r, c, grid[r][c].value, false);
                return;
            }

            // Mark #
            await highlightLine(77);
            setCell(r, c, '#', false, true); // Visited style
            await wait();

            // Recurse
            await highlightLine(80); await dfs(r+1, c);
            await highlightLine(81); await dfs(r-1, c);
            await highlightLine(82); await dfs(r, c+1);
            await highlightLine(83); await dfs(r, c-1);
            
            // Clean up visual state if needed, though we leave it as #
            setCell(r, c, '#', false, false);
        }

        // Start
        init();

    </script>
</body>
</html>